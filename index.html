<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Octopus by jinbow</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Octopus</h1>
      <h2 class="project-tagline">Offline calculation of particle trajectories</h2>
      <a href="https://github.com/jinbow/Octopus" class="btn">View on GitHub</a>
      <a href="https://github.com/jinbow/Octopus/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/jinbow/Octopus/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="octopus" class="anchor" href="#octopus" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Octopus</h1>

<h2>
<a id="offline-calculation-of-lagrangian-trajectories" class="anchor" href="#offline-calculation-of-lagrangian-trajectories" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Offline calculation of Lagrangian trajectories</h2>

<p>This model is in a development stage. Email me for questions.</p>

<p>Jinbo Wang <a href="mailto:jinbow@gmail.com">jinbow@gmail.com</a>
Scripps Institution of Oceanography
August 26, 2015</p>

<p>There are two configurations: Lagrangian particle and Argo float. </p>

<p>Use "make" to compile the code for Lagrangian particle simulation. Use "make argo" for simulating Argo float. </p>

<p>Before running the model, go to scripts folder and run "python gen_data.py" to compute the necessary data needed by the code.</p>

<h3>
<a id="lagrangian-particle-simulation" class="anchor" href="#lagrangian-particle-simulation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Lagrangian particle simulation</h3>

<h4>
<a id="steps-to-run" class="anchor" href="#steps-to-run" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Steps to run:</h4>

<p>The model is currently setup for the Southern Ocean State Estimate (SOSE). But it can be easily modified to fit any MITgcm output or any C-grid model output. To run the code, first make sure the model knows where to find your model output and correctly reads them. </p>

<ol>
<li>Edit the parameters in <strong>src/size.h</strong> to fit the data you have.</li>
<li>Edit cpp_options.h to include or exclude features. Make sure <strong>isArgo</strong> is turned off in <strong>cpp_options.h</strong>: <strong>#undef isArgo</strong>
</li>
<li>
<p>Within <strong>src/</strong> folder. Compile the code using</p>

<blockquote>
<p>make</p>
</blockquote>

<p>You will get an executable file named <strong>O.particle</strong>.</p>
</li>
<li><p>Prepare the initialization file using <strong>scritps/init_particl_xyz.py</strong>. Copy the binary file to <strong>src/</strong>.</p></li>
<li>
<p>If you run particle with the SOSE 1/6th degree simulation, download necessary binary files:</p>

<blockquote>
<p>bash sync_data.sh</p>
</blockquote>

<p>otherwise, go to scripts folder and run</p>

<blockquote>
<p>python gen_data.py</p>
</blockquote>

<p>to generate the binary files.</p>
</li>
<li>
<p>After running gen_data.py, you should get a list of binary files in your <strong>pth_data_out</strong> folder specified in <strong>data.nml</strong> including</p>

<ol>
<li>reflect_x.bin</li>
<li>reflect_y.bin</li>
<li>z_to_k_lookup_table.bin</li>
<li>k_to_z_lookup_table.bin.</li>
</ol>
</li>
<li><p>Set parameters in the namelist file <strong>data.nml</strong>. The parameters are explained line by line in <strong>src/data.nml.explained</strong>.</p></li>
<li>
<p>In the <strong>src/</strong> folder, run the model</p>

<blockquote>
<p>./O.particle</p>
</blockquote>
</li>
<li><p>Outputs are saved in the folder  <strong>output_dir</strong> specified in <strong>data.nml</strong>.</p></li>
</ol>

<h3>
<a id="argo-simulation" class="anchor" href="#argo-simulation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Argo simulation</h3>

<h4>
<a id="steps-to-run-1" class="anchor" href="#steps-to-run-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Steps to run:</h4>

<p>Most of the steps are the same as for Lagrangian particle simulation with few exceptions. </p>

<ol>
<li>Make sure <strong>isArgo</strong> is defined in <strong>cpp_options.h</strong>:  <strong>#define isArgo</strong>
</li>
<li>Use <em>"make argo"</em>  to compile the code. </li>
<li>You will get a executable <strong>O.argo</strong> after successfully compiling the code. </li>
<li>
<p>Run the code using</p>

<blockquote>
<p>./O.argo</p>
</blockquote>
</li>
</ol>

<h3>
<a id="parameterizations" class="anchor" href="#parameterizations" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Parameterizations</h3>

<h4>
<a id="laplacian-diffusion" class="anchor" href="#laplacian-diffusion" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Laplacian diffusion</h4>

<p>Use random walk to mimic the Laplacian diffusion. The random number with normal distribution is generated by <strong>random.f90</strong>. The value of the horizontal diffusion is set in <strong>Khdiff</strong> in <strong>data.nml</strong>.</p>

<ol>
<li>Before compiling the code, use <strong>#define use_Laplacian_diffusion</strong> in <strong>cpp_options.h</strong> to turn it on. </li>
<li>Use <strong>Khdiff</strong> and <strong>Kvdiff</strong> to set the Laplacian diffusivity in horizontal and vertical, respectively. The unit is m^2/s.</li>
</ol>

<h4>
<a id="mixed-layer-processes" class="anchor" href="#mixed-layer-processes" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Mixed Layer processes</h4>

<p><strong>Use this with caution</strong></p>

<p>This is a rather ad-hoc solution. No existing study has confirmed the robustness of this parameterization. </p>

<p>The idea is that the vertical mixing induced by mixed layer instability, which is usually parameterized by KPP (large et al. 1997), is missing for velocity-based Lagrangian trajectory integration. If we use particle density to represent passive tracers, we need to add random walk to particle position to mimic the parameterized vertical mixing in coarse resolution models. It is computationally too expensive to explicitly calculate the vertical mixing according to for example a K-profile of KPP. Our ad-hoc solution is to find particles within mixed layer and reshuffle them using a random-displacement model. </p>

<p>The model needs the following to run with mixed layer parameterization:</p>

<ol>
<li>turn on the parameterization in <strong>cpp_options.h</strong>: <strong>#define use_mixedlayer_shuffle</strong>
</li>
<li>prepare a data file with mixed layer depth (MLD)</li>
<li>specific the parameters in <strong>data.nml</strong>

<ol>
<li><strong>fn_MLD='your mixed layer depth file name'</strong></li>
<li>
<strong>dt_mld=432000,</strong> the time interval (in seconds) of the MLD data. For example, if you saved you MLD every 5 days, then <strong>dt_mld=432000</strong>
</li>
</ol>
</li>
</ol>

<h4>
<a id="meridional-boundary-condition" class="anchor" href="#meridional-boundary-condition" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Meridional boundary condition</h4>

<ol>
<li>Use <strong>#define reflective_meridional_boundary</strong> to turn on the reflective meridional boundaries. Particles will keep bouncing back to the domain.</li>
<li>Use <strong>#undef reflective_meridional_boundary</strong> to turn it off. Particles will stay stagnant outside.</li>
</ol>

<h4>
<a id="zonal-boundary-condition" class="anchor" href="#zonal-boundary-condition" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Zonal boundary condition</h4>

<p>Right now the zonal boundary condition is hard-coded as <strong>periodic</strong>.</p>

<h4>
<a id="reflective-continent" class="anchor" href="#reflective-continent" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Reflective continent</h4>

<p>Occasionally, particles enter continent, i.e., the dry cells. You can either keep them there or perform a rescue. </p>

<ol>
<li>Use <strong>#define reflective_continent</strong> to turn on reflective continent boundary condition. </li>
<li>use <strong>#undef reflective_continent</strong> to turn it off. Particles will then stay stagnant once enter a dry grid cell. </li>
</ol>

<h4>
<a id="looping-condition" class="anchor" href="#looping-condition" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Looping condition</h4>

<p>With usually short duration of a numerical simulation, a common practice to obtain a Lagrangian simulation with a longer duration than the Eulerian fields is to loop the velocity from the starting point. This is rather a poor-man's solution, and strongly discouraged. However, if it is preferred, there are too options.</p>

<ol>
<li>Before compilation, use  <strong>#define jump_looping</strong> in <strong>cpp_options.h</strong> to turn on the jumping condition for looping, i.e., applying an artificial jump to make sure particle stay on the same isopycnal level before and after looping.</li>
<li>Use <strong>undef jump_looping</strong> to turn it off. The code will just use the first step velocity to continue to advect particles once it reaches the end of the Eulerian field without doing anything on particle positions.</li>
</ol>

<p>Good luck!</p>

<p>Jinbo Wang</p>

<p>April 24, 2016</p>

<h2>
<a id="faq" class="anchor" href="#faq" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>FAQ</h2>

<h3>
<a id="compiling-errors" class="anchor" href="#compiling-errors" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>compiling errors</h3>

<ol>
<li>
<p>use "make argo" instead of "make" to compile if you got the following:</p>

<blockquote>
<p>get_velocity.o: In function find_particle_uvw_:
get_velocity.f90:(.text+0xa01): undefined reference to get_argo_w_
collect2: error: ld returned 1 exit status
make: *** [opt] Error 1</p>
</blockquote>
</li>
</ol>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/jinbow/Octopus">Octopus</a> is maintained by <a href="https://github.com/jinbow">jinbow</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
